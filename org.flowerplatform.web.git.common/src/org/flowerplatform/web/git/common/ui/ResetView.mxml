<?xml version="1.0" encoding="utf-8"?>
<!--
	@author Cristina Constantinescu
-->
<popup:Wizard xmlns:fx="http://www.adobe.com/2006/mxml" 
			  xmlns:s="library://ns.adobe.com/flex/spark" 
			  xmlns:mx="library://ns.adobe.com/flex/mx" 
			  xmlns:popup="org.flowerplatform.flexutil.popup.*"
			  xmlns:component="org.flowerplatform.web.git.common.ui.component.*" >
	
	<fx:Script>
		<![CDATA[
			import com.crispico.flower.util.spinner.ModalSpinner;
			
			import org.flowerplatform.common.CommonPlugin;
			import org.flowerplatform.communication.CommunicationPlugin;
			import org.flowerplatform.communication.tree.remote.GenericTreeStatefulClient;
			import org.flowerplatform.flexutil.FlexUtilGlobals;
			import org.flowerplatform.flexutil.popup.IPopupHost;
			import org.flowerplatform.web.git.common.BranchTreeStatefulClient;
			import org.flowerplatform.web.git.common.GitCommonPlugin;
			import org.flowerplatform.web.git.common.remote.dto.GitActionDto;
			
			[Bindable]
			public var dto:GitActionDto;
			
			override public function set popupHost(value:IPopupHost):void {
				super.popupHost = value;
				popupHost.setLabel(GitCommonPlugin.getInstance().getMessage('git.resetPage.title'));
				popupHost.setIcon(GitCommonPlugin.getInstance().getResourceUrl('images/full/obj16/reset.gif'));
			}
			
			protected override function creationCompleteHandler():void {
				super.creationCompleteHandler();
				wizardImage.source = GitCommonPlugin.getInstance().getResourceUrl("images/newconnect_wizban.png");
				
				var statefulClient:GenericTreeStatefulClient = new BranchTreeStatefulClient();
				
				branchPage.tree.statefulClient = statefulClient;				
				statefulClient.treeList = branchPage.tree;
				
				CommunicationPlugin.getInstance().statefulClientRegistry.register(statefulClient, null);
				
				popupHost.showSpinner(CommonPlugin.getInstance().getMessage("spinner.gettingData"));
				branchPage.tree.statefulClient.openNode(dto.repositoryNode, this, getData_callbackHandler);
			}
			
			private function getData_callbackHandler(value:Object):void {
				popupHost.hideSpinner();
			}
			
			protected override function finishClickHandler():void {	
				var branch:String = branchPage.getSelectedBranch();
				if (branch == null) {
					FlexUtilGlobals.getInstance().messageBoxFactory.createMessageBox()
						.setTitle(CommonPlugin.getInstance().getMessage("error"))
						.setText(GitCommonPlugin.getInstance().getMessage("git.merge.selectRef"))
						.showMessageBox();					
					return;
				}
				GitCommonPlugin.getInstance().service.reset(dto.repository, branch, int(resetTypeGroup.selectedValue), null, null);
				super.finishClickHandler();
			}
									
			protected override function removePopup():void {	
				CommunicationPlugin.getInstance().statefulClientRegistry.unregister(branchPage.tree.statefulClient, null);
				super.removePopup();
			}
			
		]]>
	</fx:Script>
	
	<s:RadioButtonGroup id="resetTypeGroup" />
	
	<popup:states>				
		<mx:State name="0">			
			<mx:SetProperty name="wizardTitle" value="{GitCommonPlugin.getInstance().getMessage('git.resetPage.subTitle', [dto.repositoryNode.pathFragment.name])}"/>
			<mx:SetProperty name="wizardDescription" value="{GitCommonPlugin.getInstance().getMessage('git.resetPage.description')}"/>
			<mx:SetProperty target="{finish}" name="label" value="{GitCommonPlugin.getInstance().getMessage('git.resetPage.title')}"/>
			<mx:SetProperty target="{next}" name="visible" value="false"/>
			<mx:SetProperty target="{back}" name="visible" value="false"/>
			
			<mx:AddChild relativeTo="{contentArea}">
				<s:VGroup width="100%" height="100%" verticalAlign="middle">
					<component:BranchSelectionPage id="branchPage" width="100%" height="100%" minHeight="100" />	
					
					<s:Label text="{GitCommonPlugin.getInstance().getMessage('git.resetPage.resetType')}" />					
					<s:RadioButton groupName="resetTypeGroup" 									        
									label="{GitCommonPlugin.getInstance().getMessage('git.resetPage.softType')}" 
									width="100%"
									selected="true"
									value="0"/>
					<s:RadioButton groupName="resetTypeGroup" 									        
									label="{GitCommonPlugin.getInstance().getMessage('git.resetPage.mixedType')}" 
									width="100%"
									selected="true"
									value="1"/>
					<s:RadioButton groupName="resetTypeGroup" 											        
									label="{GitCommonPlugin.getInstance().getMessage('git.resetPage.hardType')}"									
									width="100%"
									value="2"/>		
				</s:VGroup>				
			</mx:AddChild>
		</mx:State>		
	</popup:states>
	
</popup:Wizard>
